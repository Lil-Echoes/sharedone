<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pricens">

	<select id="priceList" resultType="price" parameterType="price">
		SELECT pc.*,b.buyerNM,pd.productNM FROM m_price pc, M_buyer b, m_product pd
		<where>
			<if test="bcdnm != null and bcdnm !=''">
				UPPER(b.buyerCD) like UPPER('%'||#{bcdnm}||'%') OR
				UPPER(buyerNM) like UPPER('%'||#{bcdnm}||'%') AND
			</if>
			<if test="pcdnm != null and pcdnm !=''">
				UPPER(pc.productCD) like UPPER('%'||#{pcdnm}||'%') OR
				UPPER(productNM) like UPPER('%'||#{pcdnm}||'%') AND
			</if>
			<if test="periodStart != null">
				periodStart like '%'||#{periodStart}||'%' AND
			</if>
			 pc.del='n' and pc.buyerCD=b.buyerCD and pc.productCD=pd.productCD 
		</where>
		ORDER BY periodStart
	</select>
	
	<select id="priceDetail" parameterType="String" resultType="price">
		SELECT pc.*,b.buyerNM,pd.productNM FROM m_price pc, M_buyer b, m_product pd WHERE pc.buyerCD=b.buyerCD and pc.productCd=pd.productCd and buyerCD = #{buyerCD} and productCD = #{productCD} and periodStart = #{periodStart}
	</select>
	
	<update id="pricetUpdate" parameterType="price">
		UPDATE m_price SET buyerNM=#{buyerNM} and productNM=#{productNM} and periodStart=#{periodStart} and listPrice=#{listPrice} and currency=#{currency} FROM price pc, M_buyer b, m_product pd WHERE pc.buyerCD=b.buyerCD and pc.productCd=pd.productCd and buyerCD = #{buyerCD} and productCD = #{productCD} and periodStart = #{periodStart}
	</update>
	
	<delete id="priceDelete" parameterType="map">
		DELETE m_price WHERE buyerCD=#{buyerCD} and productCD=#{productCD} and periodStart=#{periodStart}
	</delete>
	
	<insert id="priceInsert" parameterType="price">
		INSERT INTO m_price VALUES (#{buyerCD}, #{productCD}, #{periodStart}, #{periodStart}, #{listPrice}, #{currency}, 'n')
	</insert>
	
	<select id="delList" parameterType="string" resultType="string">
		select del from m_price where buyerCD=#{buyerCD} and productCD=#{productCD} and periodStart=#{periodStart}
	</select>
	
	<update id="deletePrice" parameterType="map">
		update m_price set del=#{delList} where buyerCD=#{buyerCD} and productCD=#{productCD} and periodStart=#{periodStart}
	</update>
	
</mapper>